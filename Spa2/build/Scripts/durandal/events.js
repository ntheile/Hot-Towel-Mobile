define(["durandal/system"],function(e){var t=/\s+/,n=function(){},i=function(e,t){this.owner=e,this.events=t};return i.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},i.prototype.on=i.prototype.then,i.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},n.prototype.on=function(e,n,r){var a,o,u;if(n){for(a=this.callbacks||(this.callbacks={}),e=e.split(t);o=e.shift();)u=a[o]||(a[o]=[]),u.push(n,r);return this}return new i(this,e)},n.prototype.off=function(n,i,r){var a,o,u,s;if(!(o=this.callbacks))return this;if(!(n||i||r))return delete this.callbacks,this;for(n=n?n.split(t):e.keys(o);a=n.shift();)if((u=o[a])&&(i||r))for(s=u.length-2;s>=0;s-=2)i&&u[s]!==i||r&&u[s+1]!==r||u.splice(s,2);else delete o[a];return this},n.prototype.trigger=function(e){var n,i,r,a,o,u,s,l;if(!(i=this.callbacks))return this;for(l=[],e=e.split(t),a=1,o=arguments.length;o>a;a++)l[a-1]=arguments[a];for(;n=e.shift();){if((s=i.all)&&(s=s.slice()),(r=i[n])&&(r=r.slice()),r)for(a=0,o=r.length;o>a;a+=2)r[a].apply(r[a+1]||this,l);if(s)for(u=[n].concat(l),a=0,o=s.length;o>a;a+=2)s[a].apply(s[a+1]||this,u)}return this},n.prototype.proxy=function(e){var t=this;return function(n){t.trigger(e,n)}},n.includeIn=function(e){e.on=n.prototype.on,e.off=n.prototype.off,e.trigger=n.prototype.trigger,e.proxy=n.prototype.proxy},n});